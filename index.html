<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Outil de révision multi-cours</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }
        .flashcard-container {
            perspective: 1000px;
            min-height: 200px;
        }
        .flashcard {
            width: 100%;
            height: 200px;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.6s;
            cursor: pointer;
        }
        .flashcard.is-flipped {
            transform: rotateY(180deg);
        }
        .flashcard-face {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            overflow-y: auto;
            text-align: center;
        }
        .flashcard-front {
            background-color: #ffffff;
            color: #1f2937;
        }
        .flashcard-back {
            background-color: #4b5563;
            color: #ffffff;
            transform: rotateY(180deg);
        }
        .qcm-option {
            transition: background-color 0.3s;
        }
        .qcm-option:hover {
            background-color: #e5e7eb;
        }
        .correct-answer {
            background-color: #d1fae5 !important;
            border-left: 4px solid #10b981;
        }
        .incorrect-answer {
            background-color: #fee2e2 !important;
            border-left: 4px solid #ef4444;
        }
        .btn {
            transition: background-color 0.3s, transform 0.1s;
        }
        .btn:hover {
            opacity: 0.9;
        }
        .btn:active {
            transform: scale(0.98);
        }
        .feedback-message {
            padding: 12px;
            border-radius: 8px;
            margin-top: 16px;
            font-weight: 500;
            text-align: center;
        }
        .feedback-correct {
            background-color: #d1fae5;
            color: #065f46;
        }
        .feedback-incorrect {
            background-color: #fee2e2;
            color: #991b1b;
        }
        .hidden {
            display: none;
        }
        .question-counter {
            font-size: 0.9em;
            color: #6b7280; 
            margin-bottom: 1rem;
            text-align: center;
        }
        .course-button-container {
            display: inline-flex; 
            align-items: center;
            margin-right: 8px; 
            margin-bottom: 8px; 
        }
         .course-section-title {
            font-size: 1.1em;
            font-weight: 500;
            color: #374151; 
            margin-bottom: 0.75rem;
            margin-top: 1rem;
            text-align: left;
        }
        #loadingMessage {
            text-align: center;
            padding: 20px;
            font-style: italic;
            color: #4b5563;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center justify-center p-4">

    <div class="w-full max-w-2xl bg-white shadow-xl rounded-lg p-6 md:p-8">
        <header class="mb-6 text-center">
            <h1 id="mainTitle" class="text-3xl font-bold text-gray-800">Mon Outil de Révision</h1>
        </header>

        <section id="welcomeSection" class="py-10">
            <h2 class="text-2xl font-semibold text-gray-700 mb-6 text-center">Choisissez un cours à réviser :</h2>
            <div id="courseListContainer" class="flex flex-wrap justify-center md:justify-start">
                {/* Les boutons des cours seront injectés ici */}
            </div>
            <p id="loadingMessage" class="hidden">Chargement des cours...</p>
            <p id="noCoursesMessage" class="text-gray-500 text-sm mt-4 text-center md:text-left hidden">Aucun cours disponible. Vérifiez la configuration (constantes GITHUB_USER_REPO, GITHUB_BRANCH, GITHUB_COURSES_DIRECTORY_PATH dans le script) et assurez-vous que des fichiers JSON existent dans le dossier spécifié de votre dépôt GitHub et que le dépôt est public.</p>
        </section>

        <section id="modeSelectionSection" class="hidden text-center py-10">
            <h2 id="modeSelectionTitle" class="text-2xl font-semibold text-gray-700 mb-6"></h2>
            <div class="space-y-4 md:space-y-0 md:space-x-4 md:flex md:justify-center">
                <button id="showFlashcardsBtn" class="btn bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-8 rounded-lg shadow-md w-full md:w-auto">Cartes Flash</button>
                <button id="showQcmBtn" class="btn bg-green-600 hover:bg-green-700 text-white font-semibold py-3 px-8 rounded-lg shadow-md w-full md:w-auto">QCM</button>
            </div>
            <button id="backToWelcomeFromModeBtn" class="btn bg-gray-500 hover:bg-gray-600 text-white font-semibold py-2 px-6 rounded-lg shadow-md mt-8">Retour à l'accueil</button>
        </section>

        <section id="flashcardsSection" class="hidden">
            <h2 class="text-2xl font-semibold text-gray-700 mb-2 text-center">Cartes Flash</h2>
            <div id="flashcardCounter" class="question-counter"></div>
            <div id="flashcardContainer" class="flashcard-container mb-4">
                <div id="flashcard" class="flashcard">
                    <div class="flashcard-face flashcard-front">
                        <p id="flashcardQuestion" class="text-lg"></p>
                    </div>
                    <div class="flashcard-face flashcard-back">
                        <p id="flashcardAnswer" class="text-lg"></p>
                    </div>
                </div>
            </div>
            <div id="flashcardMessage" class="text-sm text-gray-500 text-center mb-4 h-6">Cliquez sur la carte pour voir la réponse.</div>
            <div class="flex justify-center space-x-4">
                <button id="nextFlashcardBtn" class="btn bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-2 px-6 rounded-lg shadow-md">Suivante</button>
            </div>
            <button id="backToModeSelectionFromFlashcardsBtn" class="btn bg-gray-500 hover:bg-gray-600 text-white font-semibold py-2 px-6 rounded-lg shadow-md mt-6 block mx-auto">Retour au choix du mode</button>
        </section>

        <section id="qcmSection" class="hidden">
            <h2 class="text-2xl font-semibold text-gray-700 mb-2 text-center">Questionnaire à Choix Multiples</h2>
            <div id="qcmCounter" class="question-counter"></div>
            <div id="qcmContainer" class="bg-gray-50 p-6 rounded-lg shadow-inner">
                <p id="qcmQuestionElement" class="text-lg font-medium text-gray-800 mb-4"></p> 
                <div id="qcmOptions" class="space-y-3 mb-4"></div>
                <div id="qcmFeedback" class="feedback-message hidden"></div>
            </div>
            <div class="mt-6 flex justify-center space-x-4">
                 <button id="submitQcmBtn" class="btn bg-yellow-500 hover:bg-yellow-600 text-gray-800 font-semibold py-2 px-6 rounded-lg shadow-md">Valider</button>
                <button id="nextQcmBtn" class="btn bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-2 px-6 rounded-lg shadow-md hidden">Suivant</button>
            </div>
            <button id="backToModeSelectionFromQcmBtn" class="btn bg-gray-500 hover:bg-gray-600 text-white font-semibold py-2 px-6 rounded-lg shadow-md mt-6 block mx-auto">Retour au choix du mode</button>
        </section>
    </div>

    <script>
        let coursesData = {}; 
        let currentCourseKey = null;
        let currentFlashcardIndex = 0;
        let currentQcmIndex = 0;
        let selectedQcmOption = null;

        // ===================================================================================
        // CONFIGURATION IMPORTANTE POUR LE CHARGEMENT DES COURS DEPUIS GITHUB
        // ===================================================================================
        // 1. REMPLACEZ 'JulienChoi/cyoutilrevision' ci-dessous par VOTRE_NOM_UTILISATEUR_GITHUB/NOM_DE_VOTRE_DEPOT_GITHUB
        const GITHUB_USER_REPO = 'JulienLhui/cyoutilrevision'; 
        
        // 2. REMPLACEZ 'main' ci-dessous par le nom de votre branche principale si elle est différente (ex: 'master')
        const GITHUB_BRANCH = 'main'; 
        
        // 3. INDIQUEZ LE CHEMIN VERS LE DOSSIER CONTENANT VOS FICHIERS JSON DE COURS DANS LE DÉPÔT
        //    Si les fichiers sont à la racine, laissez une chaîne vide ''.
        //    Si les fichiers sont dans un dossier nommé "cours", mettez 'cours'.
        const GITHUB_COURSES_DIRECTORY_PATH = 'cours'; // MODIFIÉ : chemin vers le dossier "cours"
        // ===================================================================================

        // --- Éléments du DOM ---
        const mainTitle = document.getElementById('mainTitle');
        const welcomeSection = document.getElementById('welcomeSection');
        const courseListContainer = document.getElementById('courseListContainer');
        const loadingMessage = document.getElementById('loadingMessage');
        const noCoursesMessage = document.getElementById('noCoursesMessage');
        
        const modeSelectionSection = document.getElementById('modeSelectionSection');
        const modeSelectionTitle = document.getElementById('modeSelectionTitle');
        
        const showFlashcardsBtn = document.getElementById('showFlashcardsBtn');
        const showQcmBtn = document.getElementById('showQcmBtn');
        
        const flashcardsSection = document.getElementById('flashcardsSection');
        const flashcardElement = document.getElementById('flashcard'); 
        const flashcardQuestion = document.getElementById('flashcardQuestion');
        const flashcardAnswer = document.getElementById('flashcardAnswer');
        const nextFlashcardBtn = document.getElementById('nextFlashcardBtn');
        const flashcardMessage = document.getElementById('flashcardMessage');
        const flashcardCounter = document.getElementById('flashcardCounter');

        const qcmSection = document.getElementById('qcmSection');
        const qcmQuestionElement = document.getElementById('qcmQuestionElement');
        const qcmOptionsContainer = document.getElementById('qcmOptions');
        const submitQcmBtn = document.getElementById('submitQcmBtn');
        const nextQcmBtn = document.getElementById('nextQcmBtn');
        const qcmFeedback = document.getElementById('qcmFeedback');
        const qcmCounter = document.getElementById('qcmCounter');

        const backToWelcomeFromModeBtn = document.getElementById('backToWelcomeFromModeBtn');
        const backToModeSelectionFromFlashcardsBtn = document.getElementById('backToModeSelectionFromFlashcardsBtn');
        const backToModeSelectionFromQcmBtn = document.getElementById('backToModeSelectionFromQcmBtn');

        // Fonction pour récupérer et valider le contenu d'un fichier de cours spécifique via son URL de téléchargement direct
        async function fetchAndValidateCourseContent(downloadUrl, fileNameForLogging) {
            console.log(`GITHUB_FETCH: Tentative de chargement du contenu de ${fileNameForLogging} depuis ${downloadUrl}`);
            try {
                const response = await fetch(downloadUrl);
                if (!response.ok) {
                    console.error(`GITHUB_FETCH: Erreur HTTP! Statut: ${response.status}, Texte: ${response.statusText} pour ${fileNameForLogging} (URL: ${downloadUrl})`);
                    throw new Error(`HTTP error! status: ${response.status} pour ${fileNameForLogging}`);
                }
                const data = await response.json();
                // Valider la structure de base du cours
                if (data && typeof data.title === 'string' && Array.isArray(data.flashcards) && Array.isArray(data.qcm)) {
                    const flashcardsValid = data.flashcards.every(fc => typeof fc.question === 'string' && typeof fc.answer === 'string');
                    const qcmValid = data.qcm.every(q => {
                        if (typeof q.question !== 'string' || !Array.isArray(q.options) || typeof q.correctAnswer !== 'string') return false;
                        const cleanedCorrectAnswer = q.correctAnswer.replace(/\s*\[cite:.*?\]\s*$/, "").trim();
                        return q.options.includes(cleanedCorrectAnswer);
                    });
                    if (flashcardsValid && qcmValid) {
                        return { key: fileNameForLogging.replace('.json', ''), data: data };
                    } else {
                        console.error(`GITHUB_FETCH: Structure de contenu invalide dans ${fileNameForLogging}. Vérifiez les questions/réponses et les options/correctAnswer des QCM.`);
                        return null;
                    }
                } else {
                     console.error(`GITHUB_FETCH: Structure JSON principale invalide pour ${fileNameForLogging}. 'title', 'flashcards' (tableau), et 'qcm' (tableau) sont requis.`);
                    return null;
                }
            } catch (error) {
                console.error(`GITHUB_FETCH: Erreur lors du traitement du fichier de cours ${fileNameForLogging} depuis ${downloadUrl}:`, error);
                return null;
            }
        }

        async function loadCoursesFromGitHub() {
            console.log("GITHUB_FETCH: Début du chargement des cours depuis GitHub...");
            loadingMessage.classList.remove('hidden');
            noCoursesMessage.classList.add('hidden');
            courseListContainer.innerHTML = '';

            // URL de l'API GitHub pour lister le contenu du dossier des cours
            const apiUrl = `https://api.github.com/repos/${GITHUB_USER_REPO}/contents/${GITHUB_COURSES_DIRECTORY_PATH}?ref=${GITHUB_BRANCH}`;
            console.log(`GITHUB_FETCH: Interrogation de l'API GitHub pour le contenu du dossier: ${apiUrl}`);

            let filesToFetch = [];
            try {
                const response = await fetch(apiUrl);
                if (!response.ok) {
                    console.error(`GITHUB_FETCH: Erreur HTTP lors de la récupération de la liste des fichiers! Statut: ${response.status}, Texte: ${response.statusText} (URL: ${apiUrl})`);
                    throw new Error(`GitHub API error! status: ${response.status}`);
                }
                const directoryContents = await response.json();
                if (Array.isArray(directoryContents)) {
                    filesToFetch = directoryContents
                        .filter(item => item.type === 'file' && item.name.endsWith('.json'))
                        .map(item => ({ name: item.name, download_url: item.download_url }));
                    console.log("GITHUB_FETCH: Fichiers JSON trouvés dans le dossier:", filesToFetch.map(f => f.name));
                } else {
                    console.error("GITHUB_FETCH: La réponse de l'API GitHub pour le contenu du dossier n'est pas un tableau.", directoryContents);
                }
            } catch (error) {
                console.error("GITHUB_FETCH: Erreur lors de la récupération de la liste des fichiers depuis l'API GitHub:", error);
                loadingMessage.classList.add('hidden');
                noCoursesMessage.classList.remove('hidden');
                populateCourseList(); // Afficher la liste (qui sera vide) et le message d'erreur
                return;
            }

            if (filesToFetch.length === 0) {
                console.warn("GITHUB_FETCH: Aucun fichier .json trouvé dans le dossier spécifié sur GitHub.");
                loadingMessage.classList.add('hidden');
                noCoursesMessage.classList.remove('hidden');
                populateCourseList();
                return;
            }

            const coursePromises = filesToFetch.map(fileInfo => fetchAndValidateCourseContent(fileInfo.download_url, fileInfo.name));
            const results = await Promise.all(coursePromises);

            coursesData = {}; 
            results.forEach(result => {
                if (result && result.data) {
                    coursesData[result.key] = result.data;
                    console.log(`GITHUB_FETCH: Cours "${result.data.title}" (clé: ${result.key}) chargé avec succès.`);
                }
            });
            
            loadingMessage.classList.add('hidden');
            if (Object.keys(coursesData).length === 0) {
                noCoursesMessage.classList.remove('hidden');
                console.warn("GITHUB_FETCH: Aucun cours n'a pu être chargé correctement depuis GitHub malgré la détection de fichiers. Vérifiez les logs d'erreur ci-dessus et la structure des fichiers JSON.");
            } else {
                console.log("GITHUB_FETCH: Tous les cours disponibles ont été traités. Données finales:", coursesData);
            }
            populateCourseList();
        }


        // --- Fonctions de navigation et d'affichage ---
        function showWelcomeScreen() {
            mainTitle.textContent = "Mon Outil de Révision";
            welcomeSection.classList.remove('hidden');
            modeSelectionSection.classList.add('hidden');
            flashcardsSection.classList.add('hidden');
            qcmSection.classList.add('hidden');
            currentCourseKey = null;
            if (Object.keys(coursesData).length > 0 || loadingMessage.classList.contains('hidden')) { // Populate if data exists or loading is done
                 populateCourseList();
            }
        }
        
        function populateCourseList() {
            courseListContainer.innerHTML = ''; 
            
            if (Object.keys(coursesData).length === 0 && loadingMessage.classList.contains('hidden')) {
                noCoursesMessage.classList.remove('hidden');
                return;
            }
            noCoursesMessage.classList.add('hidden');


            Object.keys(coursesData).forEach(key => {
                const course = coursesData[key];
                const buttonContainer = document.createElement('div');
                buttonContainer.classList.add('course-button-container');

                const button = document.createElement('button');
                button.dataset.course = key;
                button.classList.add('course-btn', 'btn', 'text-white', 'font-semibold', 'py-2', 'px-4', 'rounded-lg', 'shadow-md');
                
                const colors = ['bg-sky-600 hover:bg-sky-700', 'bg-teal-600 hover:bg-teal-700', 'bg-indigo-600 hover:bg-indigo-700', 'bg-rose-600 hover:bg-rose-700', 'bg-amber-600 hover:bg-amber-700'];
                const colorIndex = Object.keys(coursesData).indexOf(key) % colors.length; 
                const colorClass = colors[colorIndex];
                button.classList.add(...colorClass.split(' '));
                button.textContent = course.title;
                button.addEventListener('click', () => {
                    currentCourseKey = button.dataset.course;
                    currentFlashcardIndex = 0; 
                    currentQcmIndex = 0;
                    showModeSelectionScreen();
                });
                buttonContainer.appendChild(button);
                courseListContainer.appendChild(buttonContainer);
            });
        }
        
        function showModeSelectionScreen() {
            if (!currentCourseKey || !coursesData[currentCourseKey]) { 
                 console.error("Attempting to access non-existent course:", currentCourseKey);
                 showWelcomeScreen(); 
                 return;
            }
            mainTitle.textContent = `Révision : ${coursesData[currentCourseKey].title}`;
            modeSelectionTitle.textContent = `Cours : ${coursesData[currentCourseKey].title}. Choisissez un mode :`;
            welcomeSection.classList.add('hidden');
            modeSelectionSection.classList.remove('hidden');
            flashcardsSection.classList.add('hidden');
            qcmSection.classList.add('hidden');
        }

        function showFlashcardsScreen() {
            if (!currentCourseKey || !coursesData[currentCourseKey]) { showWelcomeScreen(); return; }
            mainTitle.textContent = `Cartes Flash : ${coursesData[currentCourseKey].title}`;
            modeSelectionSection.classList.add('hidden');
            flashcardsSection.classList.remove('hidden');
            qcmSection.classList.add('hidden');
            displayFlashcard();
        }

        function showQcmScreen() {
            if (!currentCourseKey || !coursesData[currentCourseKey]) { showWelcomeScreen(); return; }
            mainTitle.textContent = `QCM : ${coursesData[currentCourseKey].title}`;
            modeSelectionSection.classList.add('hidden');
            flashcardsSection.classList.add('hidden');
            qcmSection.classList.remove('hidden');
            displayQcm();
        }
        
        function displayFlashcard() {
            if (!coursesData[currentCourseKey] || !coursesData[currentCourseKey].flashcards) { 
                flashcardQuestion.textContent = "Erreur : Données de flashcards non trouvées pour ce cours.";
                flashcardElement.classList.add('hidden');
                nextFlashcardBtn.classList.add('hidden');
                flashcardCounter.textContent = "0/0";
                return;
            }
            const courseFlashcards = coursesData[currentCourseKey].flashcards;
            if (courseFlashcards.length === 0) { 
                flashcardQuestion.textContent = "Aucune carte flash disponible pour ce cours.";
                flashcardAnswer.textContent = "";
                flashcardMessage.textContent = "Vérifiez le fichier JSON du cours sur GitHub.";
                nextFlashcardBtn.classList.add('hidden');
                flashcardElement.classList.add('hidden');
                flashcardCounter.textContent = "0/0";
                return;
            }
            flashcardElement.classList.remove('hidden');
            nextFlashcardBtn.classList.remove('hidden');
            
            const currentCard = courseFlashcards[currentFlashcardIndex];
            flashcardQuestion.textContent = currentCard.question;
            flashcardAnswer.textContent = currentCard.answer;
            flashcardElement.classList.remove('is-flipped');
            flashcardMessage.textContent = "Cliquez sur la carte pour voir la réponse.";
            flashcardCounter.textContent = `${currentFlashcardIndex + 1}/${courseFlashcards.length}`;
        }

        function flipFlashcard() {
            if (!currentCourseKey || !coursesData[currentCourseKey] || !coursesData[currentCourseKey].flashcards || coursesData[currentCourseKey].flashcards.length === 0) return;
            flashcardElement.classList.toggle('is-flipped');
             if (flashcardElement.classList.contains('is-flipped')) {
                flashcardMessage.textContent = "Cliquez sur la carte pour voir la question.";
            } else {
                flashcardMessage.textContent = "Cliquez sur la carte pour voir la réponse.";
            }
        }

        function nextFlashcard() {
            const courseFlashcards = coursesData[currentCourseKey].flashcards;
            if (!courseFlashcards || courseFlashcards.length === 0) return;
            currentFlashcardIndex = (currentFlashcardIndex + 1) % courseFlashcards.length;
            displayFlashcard();
        }

        function displayQcm() {
             if (!coursesData[currentCourseKey] || !coursesData[currentCourseKey].qcm) { 
                qcmQuestionElement.textContent = "Erreur : Données de QCM non trouvées pour ce cours.";
                qcmOptionsContainer.innerHTML = "";
                submitQcmBtn.classList.add('hidden');
                nextQcmBtn.classList.add('hidden');
                qcmCounter.textContent = "0/0";
                return;
            }
            const courseQCMs = coursesData[currentCourseKey].qcm;
            if (courseQCMs.length === 0) { 
                qcmQuestionElement.textContent = "Aucun QCM disponible pour ce cours.";
                qcmOptionsContainer.innerHTML = "";
                submitQcmBtn.classList.add('hidden');
                nextQcmBtn.classList.add('hidden');
                qcmFeedback.classList.add('hidden');
                qcmCounter.textContent = "0/0";
                return;
            }

            submitQcmBtn.classList.remove('hidden');
            nextQcmBtn.classList.add('hidden');
            qcmFeedback.classList.add('hidden');
            qcmFeedback.textContent = '';
            qcmFeedback.className = 'feedback-message hidden';

            const currentQ = courseQCMs[currentQcmIndex];
            qcmQuestionElement.textContent = currentQ.question;
            qcmOptionsContainer.innerHTML = ''; 
            qcmCounter.textContent = `${currentQcmIndex + 1}/${courseQCMs.length}`;

            currentQ.options.forEach(option => {
                const optionId = `qcm-option-${option.replace(/\s+/g, '-').replace(/[^\w-]/g, '')}`;
                const div = document.createElement('div');
                div.classList.add('qcm-option', 'p-3', 'bg-white', 'rounded-lg', 'border', 'border-gray-300', 'cursor-pointer', 'hover:bg-gray-100');
                
                const input = document.createElement('input');
                input.type = 'radio';
                input.name = 'qcmOption';
                input.value = option;
                input.id = optionId; 
                input.classList.add('mr-3', 'accent-blue-500');

                const label = document.createElement('label');
                label.htmlFor = optionId;
                label.textContent = option;
                label.classList.add('text-gray-700', 'w-full', 'cursor-pointer');

                div.appendChild(input);
                div.appendChild(label);
                
                div.addEventListener('click', () => {
                    document.querySelectorAll('#qcmOptions > div').forEach(d => d.classList.remove('ring-2', 'ring-blue-500', 'bg-blue-50'));
                    div.classList.add('ring-2', 'ring-blue-500', 'bg-blue-50');
                    input.checked = true; 
                    selectedQcmOption = option;
                    submitQcmBtn.disabled = false; 
                });
                qcmOptionsContainer.appendChild(div);
            });
            selectedQcmOption = null; 
            submitQcmBtn.disabled = true; 
        }

        function submitQcm() {
            if (selectedQcmOption === null) {
                qcmFeedback.textContent = "Veuillez sélectionner une réponse.";
                qcmFeedback.className = 'feedback-message feedback-incorrect';
                qcmFeedback.classList.remove('hidden');
                return;
            }

            const currentQ = coursesData[currentCourseKey].qcm[currentQcmIndex];
            const cleanedStoredCorrectAnswer = currentQ.correctAnswer.replace(/\s*\[cite:.*?\]\s*$/, "").trim();

            const isCorrect = selectedQcmOption === cleanedStoredCorrectAnswer;

            qcmFeedback.classList.remove('hidden');
            if (isCorrect) {
                qcmFeedback.textContent = "Bonne réponse !";
                qcmFeedback.className = 'feedback-message feedback-correct';
            } else {
                qcmFeedback.textContent = `Mauvaise réponse. La bonne réponse était : ${cleanedStoredCorrectAnswer}`;
                qcmFeedback.className = 'feedback-message feedback-incorrect';
            }

            const optionsDivs = qcmOptionsContainer.querySelectorAll('div');
            optionsDivs.forEach(div => {
                const input = div.querySelector('input');
                div.classList.remove('ring-2', 'ring-blue-500', 'bg-blue-50'); 
                div.style.pointerEvents = 'none'; 

                if (input.value === cleanedStoredCorrectAnswer) { 
                    div.classList.add('correct-answer');
                } else if (input.value === selectedQcmOption && !isCorrect) {
                    div.classList.add('incorrect-answer');
                }
            });

            submitQcmBtn.classList.add('hidden'); 
            nextQcmBtn.classList.remove('hidden'); 
        }

        function nextQcm() {
            const courseQCMs = coursesData[currentCourseKey].qcm;
            if (!courseQCMs || courseQCMs.length === 0) return;
            currentQcmIndex = (currentQcmIndex + 1) % courseQCMs.length;
            displayQcm();
            submitQcmBtn.classList.remove('hidden'); 
            nextQcmBtn.classList.add('hidden'); 
            qcmFeedback.classList.add('hidden'); 
            
            const optionsDivs = qcmOptionsContainer.querySelectorAll('div');
            optionsDivs.forEach(div => {
                div.style.pointerEvents = 'auto';
            });
        }

        // --- Écouteurs d'événements ---
        showFlashcardsBtn.addEventListener('click', showFlashcardsScreen);
        showQcmBtn.addEventListener('click', showQcmScreen);

        flashcardElement.addEventListener('click', flipFlashcard); 
        nextFlashcardBtn.addEventListener('click', nextFlashcard);

        submitQcmBtn.addEventListener('click', submitQcm);
        nextQcmBtn.addEventListener('click', nextQcm);

        backToWelcomeFromModeBtn.addEventListener('click', showWelcomeScreen);
        backToModeSelectionFromFlashcardsBtn.addEventListener('click', showModeSelectionScreen);
        backToModeSelectionFromQcmBtn.addEventListener('click', showModeSelectionScreen);

        // --- Initialisation ---
        document.addEventListener('DOMContentLoaded', () => {
            showWelcomeScreen(); 
            loadCoursesFromGitHub(); 
        });
    </script>
</body>
</html>
